<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Class Nodes</title>
    <meta name="description" content="UML Class-like nodes showing two collapsible lists of items." />
    <!-- Copyright 1998-2018 by Northwoods Software Corporation. -->
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gojs/1.8.35/go.js"></script>
    <script type="text/javascript" language="javascript" src="data.js"></script>
    <script id="code">
        function init() {
            var $ = go.GraphObject.make;

            myDiagram =
                $(go.Diagram, "myDiagramDiv",
                    {
                        initialContentAlignment: go.Spot.Center,
                        "undoManager.isEnabled": true,
                        layout: $(go.TreeLayout,
                            { // this only lays out in trees nodes connected by "generalization" links
                                angle: 90,
                                path: go.TreeLayout.PathSource,  // links go from child to parent
                                setsPortSpot: false,  // keep Spot.AllSides for link connection spot
                                setsChildPortSpot: false,  // keep Spot.AllSides
                                // nodes not connected by "generalization" links are laid out horizontally
                                arrangement: go.TreeLayout.ArrangementHorizontal
                            })
                    });

            myDiagram.contextMenu =
                $(go.Adornment, "Vertical",
                    $("ContextMenuButton",
                        $(go.TextBlock, "Download as PNG image"),
                        { click:  makePNG}),
                    $("ContextMenuButton",
                        $(go.TextBlock, "Download as SVG image"),
                        { click:  makeSvg})
                );

            // show visibility or access as a single character at the beginning of each property or method
            function convertVisibilityMethod(v) {

                switch (v) {
                    case "public": return "Ellipse";
                    case "private": return "Rectangle";
                    case "protected": return "Diamond";
                    case "package": return "~";
                    default: return v;
                }
            }

            function convertVisiblityColorMethod(v) {

                switch(v) {
                    case "public":
                        return "#619b71";
                    case "private":
                        return "red";
                    case "protected":
                        return "yellow";
                    case "package":
                        return "~";
                    default:
                        return v
                }
            }

            function convertVisibilityProperties(v) {

                switch (v) {
                    case "public": return "Rectangle";
                    case "private": return "Rectangle";
                    case "protected": return "Rectangle";
                    case "package": return "~";
                    default: return v;
                }
            }

            function convertVisiblityColorProperties(v) {

                switch(v) {
                    case "public":
                        return "#619b71";
                    case "private":
                        return "red";
                    case "protected":
                        return "yellow";
                    case "package":
                        return "~";
                    default:
                        return v
                }
            }

            function getType(v) {

                return v[0];

            }

            // PNG

            function myCallback(blob) {
                var url = window.URL.createObjectURL(blob);

                console.log(blob);

                var type = blob.type;
                var filename = data.appName;

                if (type == "image/svg+xml") {
                    filename += ".svg";
                } else if (type == "image/png") {
                    filename += ".png";
                }

                var a = document.createElement("a");
                a.style = "display: none";
                a.href = url;
                a.download = filename;

                // IE 11
                if (window.navigator.msSaveBlob !== undefined) {
                    window.navigator.msSaveBlob(blob, filename);
                    return;
                }

                document.body.appendChild(a);
                requestAnimationFrame(function() {
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                });
            }

            function makePNG() {
                var blob = myDiagram.makeImageData( { background: "white", returnType: "blob", callback: myCallback });
            }

            function makeSvg() {
                var svg = myDiagram.makeSvg({ scale: 1, background: "white" });
                var svgstr = new XMLSerializer().serializeToString(svg);
                var blob = new Blob([svgstr], { type: "image/svg+xml" });
                myCallback(blob);
            }

            // the item template for properties
            var propertyTemplate =
                $(go.Panel, "Horizontal",
                    // property visibility/access
                    $(go.Shape,
                        { width: 7, height: 7, column: 0, strokeWidth: 1, stroke:"#aaaaaa", margin: 4,
                            // but disallow drawing links from or to this shape:
                            fromLinkable: false, toLinkable: false },
                        new go.Binding("figure", "visibility", convertVisibilityProperties),
                        new go.Binding("fill", "visibility", convertVisiblityColorProperties)),
                    $(go.TextBlock,
                        { isMultiline: false, editable: false },
                        new go.Binding("text", "name").makeTwoWay(),
                        new go.Binding("isUnderline", "scope", function(s) { return s[0] === 'c' })),
                    // property type, if known
                    $(go.TextBlock, "",
                        new go.Binding("text", "type", function(t) { return (t ? ": " : ""); })),
                    $(go.TextBlock,
                        { isMultiline: false, editable: false },
                        new go.Binding("text", "type").makeTwoWay()),
                    // property default value, if any
                    $(go.TextBlock,
                        { isMultiline: false, editable: false },
                        new go.Binding("text", "default", function(s) { return s ? " = " + s : ""; }))
                );

            // the item template for methods
            var methodTemplate =
                $(go.Panel, "Horizontal",
                    // method visibility/access
                    $(go.Shape,
                        { width: 7, height: 7, column: 0, strokeWidth: 1, stroke:"#aaaaaa", margin: 4,
                            // but disallow drawing links from or to this shape:
                            fromLinkable: false, toLinkable: false },
                        new go.Binding("figure", "visibility", convertVisibilityMethod),
                        new go.Binding("fill", "visibility", convertVisiblityColorMethod)),
                    $(go.TextBlock,
                        { isMultiline: false, editable: false },
                        new go.Binding("text", "name").makeTwoWay(),
                        new go.Binding("isUnderline", "scope", function(s) { return s[0] === 'c' })),
                    // method parameters
                    $(go.TextBlock, "()",
                        // this does not permit adding/editing/removing of parameters via inplace edits
                        new go.Binding("text", "parameters", function(parr) {
                            var s = "(";
                            for (var i = 0; i < parr.length; i++) {
                                var param = parr[i];
                                if (i > 0) s += ", ";
                                s += param.name + ": " + param.type;
                            }
                            return s + ")";
                        })),
                    // method return type, if any
                    $(go.TextBlock, "",
                        new go.Binding("text", "type", function(t) { return (t ? ": " : ""); })),
                    $(go.TextBlock,
                        { isMultiline: false, editable: false },
                        new go.Binding("text", "type").makeTwoWay())
                );

            // this simple template does not have any buttons to permit adding or
            // removing properties or methods, but it could!
            myDiagram.nodeTemplate =
                $(go.Node, "Auto",
                    {
                        locationSpot: go.Spot.Center,
                        fromSpot: go.Spot.AllSides,
                        toSpot: go.Spot.AllSides
                    },
                    $(go.Shape, { fill: "lightyellow" }),
                    $(go.Panel, "Table",
                        { defaultRowSeparatorStroke: "black" },
                        // header
                        $(go.TextBlock,
                            {
                                row: 0, columnSpan: 2, margin: go.Margin.parse("3 10 3 25"),alignment: go.Spot.Left,
                                font: "bold 9pt sans-serif",
                                isMultiline: false, editable: false
                            },
                            new go.Binding("text", "name").makeTwoWay()),
                        $(go.Shape, "Circle",
                            { fill: "#619b71",
                                alignment: go.Spot.Left,
                                margin: 5,
                                stroke: null,
                                desiredSize: new go.Size(18, 18)
                            },
                            new go.Binding("fill", "fill"),
                        ),
                        $(go.TextBlock,
                            {
                                margin: go.Margin.parse("12 10 10 11"),
                                alignment: go.Spot.Left,
                                font: "bold 8pt sans-serif",
                                stroke: "white"
                            },
                            new go.Binding("text", "type", getType),
                        ),
                        // properties
                        $(go.TextBlock, "Properties",
                            { row: 1, font: "italic 8pt sans-serif" },
                            new go.Binding("visible", "visible", function(v) { return !v; }).ofObject("PROPERTIES")),
                        $(go.Panel, "Vertical", { name: "PROPERTIES" },
                            new go.Binding("itemArray", "properties"),
                            {
                                row: 1, margin: 3, stretch: go.GraphObject.Fill,
                                defaultAlignment: go.Spot.Left, background: "lightyellow",
                                itemTemplate: propertyTemplate
                            }
                        ),
                        $("PanelExpanderButton", "PROPERTIES",
                            { row: 1, column: 1, alignment: go.Spot.TopRight, visible: false },
                            new go.Binding("visible", "properties", function(arr) { return arr.length > 0; })),
                        // methods
                        $(go.TextBlock, "Methods",
                            { row: 2, font: "italic 8pt sans-serif" },
                            new go.Binding("visible", "visible", function(v) { return !v; }).ofObject("METHODS")),
                        $(go.Panel, "Vertical", { name: "METHODS" },
                            new go.Binding("itemArray", "methods"),
                            {
                                row: 2, margin: 3, stretch: go.GraphObject.Fill,
                                defaultAlignment: go.Spot.Left, background: "lightyellow",
                                itemTemplate: methodTemplate
                            }
                        ),
                        $("PanelExpanderButton", "METHODS",
                            { row: 2, column: 1, alignment: go.Spot.TopRight, visible: false },
                            new go.Binding("visible", "methods", function(arr) { return arr.length > 0; }))
                    )
                );

            function beanColor(r) {

                console.log(r);

                return "#619b71";
            }

            function convertIsTreeLink(r) {
                return r === "generalization";
            }

            function convertFromArrow(r) {
                switch (r) {
                    case "generalization": return "";
                    default: return "";
                }
            }

            function convertToArrow(r) {
                switch (r) {
                    case "generalization": return "Triangle";
                    case "aggregation": return "StretchedDiamond";
                    default: return "";
                }
            }

            myDiagram.linkTemplate =
                $(go.Link,
                    { routing: go.Link.Orthogonal },
                    new go.Binding("isLayoutPositioned", "relationship", convertIsTreeLink),
                    $(go.Shape),
                    $(go.Shape, { scale: 1.3, fill: "white" },
                        new go.Binding("fromArrow", "relationship", convertFromArrow)),
                    $(go.Shape, { scale: 1.3, fill: "white" },
                        new go.Binding("toArrow", "relationship", convertToArrow))
                );

            myDiagram.model = $(go.GraphLinksModel,
                {
                    copiesArrays: true,
                    copiesArrayObjects: true,
                    nodeDataArray: data.objectModel,
                    linkDataArray: data.injections
                });
        }
    </script>
    <style type="text/css">
        #myDiagramDiv {
            width: 98%;
            height: 98%;
            position: absolute;
            top:0;
            bottom: 0;
            left: 0;
            right: 0;
            overflow: scroll;
            margin: auto;
            resize: both;
        }
    </style>
</head>
<body onload="init()">
<div id="sample">
    <div id="myDiagramDiv"></div>
</div>
</body>
</html>